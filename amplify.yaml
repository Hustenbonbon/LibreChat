version: 1
frontend:
  phases:
    pre-build:
      commands:
        - npm run ci
        - cd packages/data-provider
        - npm run build
    build:
      commands:
        - cd client
        - npm run build
        - |
          cat << EOF > dist/deploy-manifest.json
          {
            "version": 1,
            "routes": [
              {
                "source": "/<*>",
                "headers": {
                  "cache-control": "s-maxage=0"
                },
                "target": "/index.html",
                "status": "200"
              }
            ],
            "framework": {
              "name": "custom",
              "version": "1.0.0"
            },
            "buildCommand": "npm run build",
            "startCommand": "npm run start"
          }
          EOF
  artifacts:
    baseDirectory: client/dist
    files:
      - '**/*'
  cache:
    paths:
      - client/node_modules/**/*
      - client/.npm/**/*
      - packages/data-provider/node_modules/**/*
      - packages/data-provider/.npm/**/*
  customHeaders:
    - pattern: '**/*'
      headers:
        - key: 'Cache-Control'
          value: 'public, max-age=0, must-revalidate'